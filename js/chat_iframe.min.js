function onMessageArrive(t){if(!isIframeShow()){var e=mantisChat.chat.pcMsgAction||"tip";"tip"===e?notifyNewMsg(t):showChatMiniDiv()}}function notifyNewMsg(t){var e={type:"msg",msg:t};mantisChat.messager.send(JSON.stringify(e)),$("#MANTIS-BTN-ICON-NORMAL").css("display","none"),isIframeShow()||(mantisChat.unReadMsgCount=mantisChat.unReadMsgCount+1,mantisChat.unReadMsgCount>0&&($("#newMsg").text(mantisChat.unReadMsgCount),$("#newMsg").css("display","block")))}function isIframeShow(){return mantisChat.isShow?!0:!1}function resendMsg(){var t="chat.chatHandler.customerSend";if(mantisChat.chat.chatId){for(var e=0;e<resendMessages.length;e++){var n=resendMessages[e],a=dateFormat(new Date,"yyyy-MM-dd hh:mm:ss");addMessage(mantisChat.paras.uid,a,n),pomelo.request(t,{content:n,sgId:mantisChat.chat.sgId,chatId:mantisChat.chat.chatId,agentId:mantisChat.chat.agent.agentId,target:"",type:"text"},function(){})}resendMessages=[]}}function requestChatInner(t,e){pomelo.disconnect(),mantisChat.chat.isConnecting=!0;var n=mantisChat.paras.probe,a=null;a=encodeURIComponent(isMobile.any?n.mbPromTxt:n.pcPromTxt),pomelo.init({host:t,port:e,log:!0},function(){var t="connectorSio.entryHandler.customerEnter";pomelo.request(t,{uid:mantisChat.paras.uid,siteId:mantisChat.paras.siteId,companyId:mantisChat.paras.companyId,buId:mantisChat.paras.buId,stag:mantisChat.paras.stag,sgId:mantisChat.paras.serviceGroupId,defaultSgId:mantisChat.paras.defaultServiceGroupId,assignedAgent:mantisChat.paras.assignedAgent,projectId:mantisChat.paras.projectId,reqInfo:getRequest(),welcome:mantisChat.chat.welcome,xst:mantisChat.paras.xst,pageparam:mantisChat.paras.pageparam,thirdAccount:mantisChat.paras.thirdAccount,thirdUid:mantisChat.paras.thirdUid,promotionMsg:a},function(t){"TRANSFER"===mantisChat.paras.mode&&(mantisChat.paras.mode="VISTOR"),t.error&&console.error("Fail to request"+JSON.stringify(t))})})}function loadConfig(){$.support.cors=!0,$.ajax({dataType:"json",url:getConfigPath()+"/config.json",crossDomain:!0,success:function(t){initConfig(t)},error:function(){console.error("fail to load config"),initConfig(defaultConfig)}})}function initConfig(t){if(!t)return void console.error("no config found");if(t.chat){var e=t.chat;initChatConfig(e)}if(t.welcome){var n=t.welcome;initWelcome(n)}if(t.msg){var a=t.msg;initMsg(a)}initChat()}function isBlank(t){var e=/^\s*$/;return null!==t.match(e)}function getConfigPath(){return location.protocol+"//"+location.hostname+"/chat/"+mantisChat.paras.companyId+"/"+mantisChat.paras.buId}function initChatConfig(t){MAX_REMINDER=t.maxRemCount||MAX_REMINDER,REMINDER_INTERVAL=t.remInterval||REMINDER_INTERVAL,mbRemoveTag=t.mbRemoveTag||!1,mantisChat.paras.multipleSites=t.multipleSites||mantisChat.paras.multipleSites,mantisChat.chat.btnMsg=t.mini_btnMsg||"",mantisChat.chat.pcTitleTxt=mantisChat.chat.btnMsg,mantisChat.chat.showAgentName=t.showAgentName,mantisChat.chat.logoUrl=t.agent_img,mantisChat.chat.agent_msg_icon=t.agent_msg_icon,mantisChat.chat.mini_resv_func_show=t.mini_resv_func_show,mantisChat.chat.mini_resv_func_hide=t.mini_resv_func_hide,mantisChat.chat.resv_ok_msg=t.resv_ok_msg,mantisChat.chat.resv_error_msg=t.resv_error_msg,mantisChat.chat.chat_alloc_msg=t.chat_alloc_msg,mantisChat.chat.mini_right_tab1=t.mini_right_tab1,mantisChat.chat.mini_right_tab2=t.mini_right_tab2,mantisChat.chat.mini_right_tab1_content=t.mini_right_tab1_content,mantisChat.chat.mini_right_tab2_content=t.mini_right_tab2_content,mantisChat.chat.offline_reminder=t.offline_reminder,mantisChat.chat.offline_reminder_msg=t.offline_reminder_msg,mantisChat.chat.pcPromTxt=t.mini_pc_prom_div,mantisChat.chat.hideImgUploadBtn=t.hideImgUploadBtn,mantisChat.chat.isHiddenCopyright=t.isHiddenCopyright,mergeProbeSetting(),setUI(mantisChat.chat)}function changePromDiv(){var t=$("#promDiv");t&&mantisChat.paras.mbtr?(t.html(mantisChat.paras.mbtr),t.show()):t.hide()}function initWelcome(t){mantisChat.chat.welcome=t||{}}function initMsg(t){mantisChat.chat.msg=t||{}}function createGuid(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})}function parseReferer(t){var e={};if(!t)return e;var n="";try{n=decodeURI(t)}catch(a){}for(var i=getUrlVars(n),o=0;o<ADVARRAY.length;o++){var s=ADVARRAY[o];if(t.indexOf(s.clue)>0){e.ad=s.ad,e.type=s.type,s.searchwd&&s.searchwd.forEach(function(t){var n=i[t];n&&n.replace(/(^s*)|(s*$)/g,"").length>0&&(e.searchwd=mySubStr(n,100))}),s.suggest&&s.suggest.forEach(function(t){var n=i[t];n&&n.replace(/(^s*)|(s*$)/g,"").length>0&&(e.suggest=mySubStr(n,100))}),s.bf_searchwd&&s.bf_searchwd.forEach(function(t){var n=i[t];n&&n.replace(/(^s*)|(s*$)/g,"").length>0&&(e.bf_searchwd=mySubStr(n,100))}),s.open_searchwd&&s.open_searchwd.forEach(function(t){var n=i[t];n&&n.replace(/(^s*)|(s*$)/g,"").length>0&&(e.open_searchwd=mySubStr(n,100))});break}}return e}function dateFormat(t,e){void 0===e&&(e=t,t=new Date);var n={M:t.getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),q:Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};return e=e.replace(/([yMdhmsqS])+/g,function(e,a){var i=n[a];return void 0!==i?(e.length>1&&(i="0"+i,i=i.substr(i.length-2)),i):"y"===a?(t.getFullYear()+"").substr(4-e.length):e})}function mySubStr(t,e){var n=t.length;return n>e&&(n=e),t.substr(0,n)}function addMantisEventListener(t,e,n){t&&(t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n.bind(t)))}function removeMantisEventListener(t,e,n){t&&(t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n.bind(t)))}function handleDragStart(t){baseMouseX=t.clientX,baseMouseY=t.clientY;var e={type:"move",msg:"MANTIS_DRAG_START",mouseX:baseMouseX,mouseY:baseMouseY};mantisChat.messager.send(JSON.stringify(e)),addMantisEventListener(document,"mouseup",handleDragEnd),addMantisEventListener(document,"mousemove",handleMousemove)}function handleMousemove(t){var e={type:"move",msg:"MANTIS_DRAG_MOUSEMOVE",offsetX:t.clientX-baseMouseX,offsetY:t.clientY-baseMouseY};mantisChat.messager.send(JSON.stringify(e))}function handleDragEnd(){var t={type:"move",msg:"MANTIS_DRAG_END"};mantisChat.messager.send(JSON.stringify(t)),removeMantisEventListener(document,"mouseup",handleDragEnd),removeMantisEventListener(document,"mousemove",handleMousemove)}function stopAgentKeyIn(){agentKeyInInterval&&clearInterval(agentKeyInInterval);var t=$("#inputFlg");t&&(t.hide(),isKeyInShow=!1),agentKeyInLimit=0}function showAgentKeyIn(){agentKeyInInterval&&clearInterval(agentKeyInInterval),agentKeyInStep=3,setTimeout(function(){var t=$("#inputFlg");t.show(),agentKeyInInterval=setInterval(function(){shineAgentKeyIn(t)},1e3)},500)}function shineAgentKeyIn(t){t&&(agentKeyInStep++,1===agentKeyInStep&&t.html("对方正在输入.&nbsp;&nbsp;"),2===agentKeyInStep&&t.html("对方正在输入..&nbsp;"),3===agentKeyInStep&&t.html("对方正在输入..."),agentKeyInStep>3&&(t.html("对方正在输入&nbsp;&nbsp;&nbsp;"),agentKeyInStep=0),agentKeyInLimit+=1,agentKeyInLimit>60&&stopAgentKeyIn())}function getCustomizeJSPath(){return location.protocol+"//"+location.hostname+"/chat/"+mantisChat.paras.companyId}function getDateFormatString(t,e){var n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours()%12===0?12:t.getHours()%12,"H+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()},a={0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,a[t.getDay()+""]));for(var i in n)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?n[i]:("00"+n[i]).substr((""+n[i]).length)));return e}function addDate(t,e){var n=new Date(t);return n=n.valueOf(),n+=24*e*60*60*1e3,n=new Date(n)}function sendEntry(t){var e={};e.uid=paras.uid,e.siteId=paras.siteId,e.stag=paras.stag,e.buId=paras.buId,e.ele=paras.ele,e.companyId=paras.companyId,e.pageUrl=paras.pageUrl,e.projectId=paras.projectId,e.reason=t,saveEntry(e)}function saveEntry(t){$.ajax({type:"POST",url:paras.entry_addr,crossDomain:!0,data:t,dataType:"json",success:function(){},error:function(){console.error("fail to save the leave page info")}})}function resetInput(t){$("#"+t).removeClass("leavingMessage-input-error"),$("."+t+"-error-msg").html("").hide()}function validateInput(t){switch(t){case"mobile":var e=$("#"+t).val();return"undefined"==typeof e||""===e||null===e?($("#mobile").addClass("leavingMessage-input-error"),$(".mobile-error-msg").html("请输入联系电话").show(),!1):/^1[3|4|5|7|8]\d{9}$/.test(e)?!0:($("#mobile").addClass("leavingMessage-input-error"),$(".mobile-error-msg").html("联系电话格式有误，请检查确认").show(),!1);case"name":return!0;case"age":return!0;case"remark":var n=$("#"+t).val();return n=n.replace("'",""),"undefined"!=typeof n&&""!==n&&null!=n&&n.length>100?($("#remark").addClass("leavingMessage-input-error"),$(".remark-error-msg").html("情况描述超过最大长度").show(),!1):($(".leavingMessageLength").html(n.length+"/100"),!0);default:return!0}}function getAttributeValue(t,e){if(!t.attributes)return null;for(var n=t.attributes,a=0;a<n.length;a++)if(e.toLowerCase()===n[a].name.toLowerCase())return n[a].value;return null}function inputfocus(t,e){t.value===getAttributeValue(t,"defaultval")&&(t.value=""),t.style.color="black",e||(t.style.border="2px solid #82C6ED")}function inputblur(t,e){""===t.value&&(t.value=getAttributeValue(t,"defaultval"),t.style.color="rgb(153, 153, 153)"),e||(t.style.border="1px solid #D5D5D5"),$("#messageInfo")&&$("#messageInfo").html("请填写以下信息,我们会尽快和您联系。")}function isTel(t){var e=/^0([1-9]{2,3}-|[1-9]{2,3})?[0-9]{7,8}$/,n=/^((\+?86)|(\(\+86\)))?(1[34578][0123456789][0-9]{8})$/;return n.test(t)||e.test(t)}function is_email(t){var e;e=new String(t);var n=e.length;return-1===e.indexOf("@",1)||-1===e.indexOf(".",1)||e.length<7?!1:"."===e.charAt(1)||"@"===e.charAt(1)?!1:"."===e.charAt(n-1)||"@"===e.charAt(n-1)?!1:!0}function validateInputNew(t){switch(t){case"mobile":var e=$("#"+t).val();return"undefined"==typeof e||""===e||null===e?($("#messageInfo").html("<label class='red'>请输入联系电话</label>"),!1):/^1[3|4|5|7|8]\d{9}$/.test(e)?!0:($("#messageInfo").html("<label class='red'>联系电话格式有误，请检查确认</label>"),!1);case"name":return!0;case"age":return!0;case"email":return!0;case"remark":var n=$("#"+t).val();return n=n.replace("'",""),"undefined"!=typeof n&&""!==n&&null!=n&&n.length>200?($("#messageInfo").html("<label class='red'>情况描述超过最大长度</label>"),!1):($(".leavingMessageLength").html(n.length+"/200"),!0);default:return!0}}function submitLeavingMessageNew(){var t=validateInputNew("name");if(t=t?validateInputNew("mobile"):!1,t=t?validateInputNew("email"):!1,t=t?validateInputNew("remark"):!1){$("#ly_btn").attr("disabled","disabled");var e={};e.uid=paras.uid,e.siteId=paras.siteId,e.stag=paras.stag,e.buId=paras.buId,e.ele=paras.ele,e.companyId=paras.companyId,e.pageUrl=paras.pageUrl,e.referer=paras.referer,e.lpUrl=paras.lpUrl,e.projectId=paras.projectId,e.reqVistorMedia=paras.reqVistorMedia,e.thirdUserId=paras.thirdUserId,e.thirdAccount=paras.thirdAccount;var n=paras.cookieRefer;try{if(n){for(var a=0;4>a;){var i=n+"";if(n=decodeURI(n),i==n)break;a+=1}if(n){var o=JSON.parse(n);o&&o.ad&&(e.reqAd=o.ad,e.reqSearchWd=mySubStr(o.searchwd,100))}}}catch(s){}e.messageType="SOURCE_CHAT_MSG",e.phone1=$("#mobile").val(),e.name="undefined"!=typeof $("#name").val()?$("#name").val():"",e.sexCode="undefined"!=typeof $('input:radio[name="sex"]:checked').val()?$('input:radio[name="sex"]:checked').val():"",e.iAge="undefined"!=typeof $("#age").val()?$("#age").val():"0",e.email="undefined"!=typeof $("#email").val()?$("#email").val():"";var r="undefined"!=typeof $("#visit_date").val()?$("#visit_date").val():"",c="undefined"!=typeof $("#visit_time").val()?$("#visit_time").val():"";e.resvTime=r+" "+c,e.content="undefined"!=typeof $("#remark").val()?$("#remark").val():"",saveResv(e)}}function saveResv(t){$.ajax({type:"POST",url:paras.resv_addr,contentType:"text/plain;charset=utf-8",crossDomain:!0,data:encodeURIComponent(JSON.stringify(t)),dataType:"json",success:function(){var t=$("#MANTIS_RESV_OK_MSG").val();t||(t="预约成功, 咨询顾问会很快联系您,请稍候..."),$("#leavingMessageSuccessText").html(t),$("#leavingMessageSuccessText").show(),$("#leavingMessageSuccess").show(),$("#leavingTabContextFirst").hide()},error:function(){var t=$("#MANTIS_RESV_ERR_MSG").val();t||(t="很遗憾，未能预约成功."),alert(t),$("#ly_btn").removeAttr("disabled")}})}!function(t){if("function"==typeof define&&define.amd)define(t);else if("object"==typeof exports)module.exports=t();else{var e=window.Cookies,n=window.Cookies=t();n.noConflict=function(){return window.Cookies=e,n}}}(function(){function t(){for(var t=0,e={};t<arguments.length;t++){var n=arguments[t];for(var a in n)e[a]=n[a]}return e}function e(n){function a(e,i,o){var s;if("undefined"!=typeof document){if(arguments.length>1){if(o=t({path:"/"},a.defaults,o),"number"==typeof o.expires){var r=new Date;r.setMilliseconds(r.getMilliseconds()+864e5*o.expires),o.expires=r}try{s=JSON.stringify(i),/^[\{\[]/.test(s)&&(i=s)}catch(c){}return i=n.write?n.write(i,e):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)),e=e.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),e=e.replace(/[\(\)]/g,escape),document.cookie=[e,"=",i,o.expires&&"; expires="+o.expires.toUTCString(),o.path&&"; path="+o.path,o.domain&&"; domain="+o.domain,o.secure?"; secure":""].join("")}e||(s={});for(var p=document.cookie?document.cookie.split("; "):[],h=/(%[0-9A-Z]{2})+/g,u=0;u<p.length;u++){var l=p[u].split("="),d=l.slice(1).join("=");'"'===d.charAt(0)&&(d=d.slice(1,-1));try{var m=l[0].replace(h,decodeURIComponent);if(d=n.read?n.read(d,m):n(d,m)||d.replace(h,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch(c){}if(e===m){s=d;break}e||(s[m]=d)}catch(c){}}return s}}return a.set=a,a.get=function(t){return a(t)},a.getJSON=function(){return a.apply({json:!0},[].slice.call(arguments))},a.defaults={},a.remove=function(e,n){a(e,"",t(n,{expires:-1}))},a.withConverter=e,a}return e(function(){})}),function(t){var e=/iPhone/i,n=/iPod/i,a=/iPad/i,i=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,o=/Android/i,s=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,r=/(?=.*\bUCBrowser\b)/i,c=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/Windows Phone/i,h=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,u=/BlackBerry/i,l=/BB10/i,d=/OppoBrowser/i,m=/Opera Mini/i,f=/(CriOS|Chrome)(?=.*\bMobile\b)/i,g=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,v=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),y=function(t,e){return t.test(e)},C=function(t){var C=t||navigator.userAgent,b=C.split("[FBAN");return"undefined"!=typeof b[1]&&(C=b[0]),b=C.split("Twitter"),"undefined"!=typeof b[1]&&(C=b[0]),this.apple={phone:y(e,C),ipod:y(n,C),tablet:!y(e,C)&&y(a,C),device:y(e,C)||y(n,C)||y(a,C)},this.amazon={phone:y(s,C),tablet:!y(s,C)&&y(c,C),device:y(s,C)||y(c,C)},this.android={phone:y(s,C)||y(i,C)||y(r,C),tablet:!y(s,C)&&!y(i,C)&&(y(c,C)||y(o,C)),device:y(s,C)||y(c,C)||y(i,C)||y(o,C)||y(d,C)||y(r,C)},this.windows={phone:y(p,C),tablet:y(h,C),device:y(p,C)||y(h,C)},this.other={blackberry:y(u,C),blackberry10:y(l,C),opera:y(m,C),firefox:y(g,C),chrome:y(f,C),device:y(u,C)||y(l,C)||y(m,C)||y(g,C)||y(f,C)},this.seven_inch=y(v,C),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},b=function(){var t=new C;return t.Class=C,t};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=C:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=b():"function"==typeof define&&define.amd?define("isMobile",[],t.isMobile=b()):t.isMobile=b()}(this),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,a,i,o,s,r=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;o>n;n+=1)s[n]=str(n,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+r+"]":"["+s.join(",")+"]",gap=r,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(a=rep[n],i=str(a,c),i&&s.push(quote(a)+(gap?": ":":")+i));else for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(i=str(a,c),i&&s.push(quote(a)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+r+"}":"{"+s.join(",")+"}",gap=r,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,n){var a;if(gap="",indent="","number"==typeof n)for(a=0;n>a;a+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(t,e){var n,a,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(a=walk(i,n),void 0!==a?i[n]=a:delete i[n]);return reviver.call(t,e,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var io="undefined"==typeof module?{}:module.exports;!function(){if(function(t,e){var n=t;n.version="0.9.16",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,a){var i,o,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),i=n.util.uniqueUri(s);var r={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(r,a),(r["force new connection"]||!n.sockets[i])&&(o=new n.Socket(r)),!r["force new connection"]&&o&&(n.sockets[i]=o),o=o||n.sockets[i],o.of(s.path.length>1?s.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(t,e){var n=t.util={},a=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(t){for(var e=a.exec(t||""),n={},o=14;o--;)n[i[o]]=e[o]||"";return n},n.uniqueUri=function(t){var n=t.protocol,a=t.host,i=t.port;return"document"in e?(a=a||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(a=a||"localhost",!i&&"https"==n&&(i=443)),(n||"http")+"://"+a+":"+(i||80)},n.query=function(t,e){var a=n.chunkQuery(t||""),i=[];n.merge(a,n.chunkQuery(e||""));for(var o in a)a.hasOwnProperty(o)&&i.push(o+"="+a[o]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(t){for(var e,n={},a=t.split("&"),i=0,o=a.length;o>i;++i)e=a[i].split("="),e[0]&&(n[e[0]]=e[1]);return n};var o=!1;n.load=function(t){return"document"in e&&"complete"===document.readyState||o?t():void n.on(e,"load",t,!1)},n.on=function(t,e,n,a){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,a)},n.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!t||n.ua.hasCORS))return new XMLHttpRequest;if(!t)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(t){return n.ua.webkit&&"undefined"==typeof importScripts?void n.load(function(){setTimeout(t,100)}):t()},n.merge=function(t,e,a,i){var o,s=i||[],r="undefined"==typeof a?2:a;for(o in e)e.hasOwnProperty(o)&&n.indexOf(s,o)<0&&("object"==typeof t[o]&&r?n.merge(t[o],e[o],r-1,s):(t[o]=e[o],s.push(e[o])));return t},n.mixin=function(t,e){n.merge(t.prototype,e.prototype)},n.inherit=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.intersect=function(t,e){for(var a=[],i=t.length>e.length?t:e,o=t.length>e.length?e:t,s=0,r=o.length;r>s;s++)~n.indexOf(i,o[s])&&a.push(o[s]);return a},n.indexOf=function(t,e,n){for(var a=t.length,n=0>n?0>n+a?0:n+a:n||0;a>n&&t[n]!==e;n++);return n>=a?-1:n},n.toArray=function(t){for(var e=[],n=0,a=t.length;a>n;n++)e.push(t[n]);return e},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(t,e){function n(){}t.EventEmitter=n,n.prototype.on=function(t,n){return this.$events||(this.$events={}),this.$events[t]?e.util.isArray(this.$events[t])?this.$events[t].push(n):this.$events[t]=[this.$events[t],n]:this.$events[t]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(t,e){function n(){a.removeListener(t,n),e.apply(this,arguments)}var a=this;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,n){if(this.$events&&this.$events[t]){var a=this.$events[t];if(e.util.isArray(a)){for(var i=-1,o=0,s=a.length;s>o;o++)if(a[o]===n||a[o].listener&&a[o].listener===n){i=o;break}if(0>i)return this;a.splice(i,1),a.length||delete this.$events[t]}else(a===n||a.listener&&a.listener===n)&&delete this.$events[t]}return this},n.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},n.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),e.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},n.prototype.emit=function(t){if(!this.$events)return!1;var n=this.$events[t];if(!n)return!1;var a=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,a);else{if(!e.util.isArray(n))return!1;for(var i=n.slice(),o=0,s=i.length;s>o;o++)i[o].apply(this,a)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(t){return 10>t?"0"+t:t}function date(t){return isFinite(t.valueOf())?t.getUTCFullYear()+"-"+f(t.getUTCMonth()+1)+"-"+f(t.getUTCDate())+"T"+f(t.getUTCHours())+":"+f(t.getUTCMinutes())+":"+f(t.getUTCSeconds())+"Z":null}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,a,i,o,s,r=gap,c=e[t];switch(c instanceof Date&&(c=date(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;o>n;n+=1)s[n]=str(n,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+r+"]":"["+s.join(",")+"]",gap=r,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(a=rep[n],i=str(a,c),i&&s.push(quote(a)+(gap?": ":":")+i));else for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(i=str(a,c),i&&s.push(quote(a)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+r+"}":"{"+s.join(",")+"}",gap=r,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(t,e,n){var a;if(gap="",indent="","number"==typeof n)for(a=0;n>a;a+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return str("",{"":t});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(t,e){var n,a,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(a=walk(i,n),void 0!==a?i[n]=a:delete i[n]);return reviver.call(t,e,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(t,e){var n=t.parser={},a=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],s=e.JSON,r=e.util.indexOf;n.encodePacket=function(t){var e=r(a,t.type),n=t.id||"",c=t.endpoint||"",p=t.ack,h=null;switch(t.type){case"error":var u=t.reason?r(i,t.reason):"",l=t.advice?r(o,t.advice):"";(""!==u||""!==l)&&(h=u+(""!==l?"+"+l:""));break;case"message":""!==t.data&&(h=t.data);break;case"event":var d={name:t.name};t.args&&t.args.length&&(d.args=t.args),h=s.stringify(d);break;case"json":h=s.stringify(t.data);break;case"connect":t.qs&&(h=t.qs);break;case"ack":h=t.ackId+(t.args&&t.args.length?"+"+s.stringify(t.args):"")}var m=[e,n+("data"==p?"+":""),c];return null!==h&&void 0!==h&&m.push(h),m.join(":")},n.encodePayload=function(t){var e="";if(1==t.length)return t[0];for(var n=0,a=t.length;a>n;n++){var i=t[n];e+="�"+i.length+"�"+t[n]}return e};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(t){var e=t.match(c);if(!e)return{};var n=e[2]||"",t=e[5]||"",r={type:a[e[1]],endpoint:e[4]||""};switch(n&&(r.id=n,r.ack=e[3]?"data":!0),r.type){case"error":var e=t.split("+");r.reason=i[e[0]]||"",r.advice=o[e[1]]||"";break;case"message":r.data=t||"";break;case"event":try{var p=s.parse(t);r.name=p.name,r.args=p.args}catch(h){}r.args=r.args||[];break;case"json":try{r.data=s.parse(t)}catch(h){}break;case"connect":r.qs=t||"";break;case"ack":var e=t.match(/^([0-9]+)(\+)?(.*)/);if(e&&(r.ackId=e[1],r.args=[],e[3]))try{r.args=e[3]?s.parse(e[3]):[]}catch(h){}break;case"disconnect":case"heartbeat":}return r},n.decodePayload=function(t){if("�"==t.charAt(0)){for(var e=[],a=1,i="";a<t.length;a++)"�"==t.charAt(a)?(e.push(n.decodePacket(t.substr(a+1).substr(0,i))),a+=Number(i)+1,i=""):i+=t.charAt(a);return e}return[n.decodePacket(t)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e){function n(t,e){this.socket=t,this.sessid=e}t.Transport=n,e.util.mixin(n,e.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(t){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t){var n=e.parser.decodePayload(t);if(n&&n.length)for(var a=0,i=n.length;i>a;a++)this.onPacket(n[a])}return this},n.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(t){this.send(e.parser.encodePacket(t))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+e.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(t,e){e.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,n){function a(t){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:e.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},e.util.merge(this.options,t),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||e.util.ua.hasCORS)){var a=this;e.util.on(n,"beforeunload",function(){a.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}t.Socket=a,e.util.mixin(a,e.EventEmitter),a.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new e.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},a.prototype.publish=function(){this.emit.apply(this,arguments);var t;for(var e in this.namespaces)this.namespaces.hasOwnProperty(e)&&(t=this.of(e),t.$emit.apply(t,arguments))},a.prototype.handshake=function(t){function n(e){e instanceof Error?(a.connecting=!1,
a.onError(e.message)):t.apply(null,e.split(":"))}var a=this,o=this.options,s=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,e.protocol,e.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!e.util.ua.hasCORS){var r=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+e.j.length,r.parentNode.insertBefore(c,r),e.j.push(function(t){n(t),c.parentNode.removeChild(c)})}else{var p=e.util.request();p.open("GET",s,!0),this.isXDomain()&&(p.withCredentials=!0),p.onreadystatechange=function(){4==p.readyState&&(p.onreadystatechange=i,200==p.status?n(p.responseText):403==p.status?a.onError(p.responseText):(a.connecting=!1,!a.reconnecting&&a.onError(p.responseText)))},p.send(null)}},a.prototype.getTransport=function(t){for(var n,a=t||this.transports,i=0;n=a[i];i++)if(e.Transport[n]&&e.Transport[n].check(this)&&(!this.isXDomain()||e.Transport[n].xdomainCheck(this)))return new e.Transport[n](this,this.sessionid);return null},a.prototype.connect=function(t){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(a,i,o,s){function r(t){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(t),n.transport?void n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){for(var t=n.transports;t.length>0&&t.splice(0,1)[0]!=n.transport.name;);t.length?r(t):n.publish("connect_failed")}},n.options["connect timeout"]))}):n.publish("connect_failed")}n.sessionid=a,n.closeTimeout=1e3*o,n.heartbeatTimeout=1e3*i,n.transports||(n.transports=n.origTransports=s?e.util.intersect(s.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),r(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),t&&"function"==typeof t&&t()})}),this},a.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},a.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},a.prototype.setBuffer=function(t){this.doBuffer=t,!t&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},a.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},a.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},a.prototype.disconnectSync=function(){var t=e.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,e.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",n,!1),t.send(null),this.onDisconnect("booted")},a.prototype.isXDomain=function(){var t=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=t},a.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},a.prototype.onOpen=function(){this.open=!0},a.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},a.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},a.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},a.prototype.onDisconnect=function(t){var e=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(e||n)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},a.prototype.reconnect=function(){function t(){if(n.connected){for(var t in n.namespaces)n.namespaces.hasOwnProperty(t)&&""!==t&&n.namespaces[t].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",e),n.removeListener("connect",e),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function e(){return n.reconnecting?n.connected?t():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(e,1e3):void(n.reconnectionAttempts++>=a?n.redoTransports?(n.publish("reconnect_failed"),t()):(n.on("connect_failed",e),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(e,n.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,a=this.options["max reconnection attempts"],i=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function n(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new a(this,"json"),this.ackPackets=0,this.acks={}}function a(t,e){this.namespace=t,this.name=e}t.SocketNamespace=n,e.util.mixin(n,e.EventEmitter),n.prototype.$emit=e.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},n.prototype.send=function(t,e){var n={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=e),this.packet(n)},n.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),n=e[e.length-1],a={type:"event",name:t};return"function"==typeof n&&(a.id=++this.ackPackets,a.ack="data",this.acks[a.id]=n,e=e.slice(0,e.length-1)),a.args=e,this.packet(a)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(t){function n(){a.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var a=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":var i=["message",t.data];"data"==t.ack?i.push(n):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,i);break;case"event":var i=[t.name].concat(t.args);"data"==t.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},a.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},a.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,n){function a(){e.Transport.apply(this,arguments)}t.websocket=a,e.util.inherit(a,e.Transport),a.prototype.name="websocket",a.prototype.open=function(){var t,a=e.util.query(this.socket.options.query),i=this;return t||(t=n.MozWebSocket||n.WebSocket),this.websocket=new t(this.prepareUrl()+a),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(t){i.onData(t.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(t){i.onError(t)},this},a.prototype.send=e.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){e.websocket.send(t)},0),this}:function(t){return this.websocket.send(t),this},a.prototype.payload=function(t){for(var e=0,n=t.length;n>e;e++)this.packet(t[e]);return this},a.prototype.close=function(){return this.websocket.close(),this},a.prototype.onError=function(t){this.socket.onError(t)},a.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},a.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},a.xdomainCheck=function(){return!0},e.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function n(){e.Transport.websocket.apply(this,arguments)}t.flashsocket=n,e.util.inherit(n,e.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var t=this,n=arguments;return WebSocket.__addTask(function(){e.Transport.websocket.prototype.open.apply(t,n)}),this},n.prototype.send=function(){var t=this,n=arguments;return WebSocket.__addTask(function(){e.Transport.websocket.prototype.send.apply(t,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,e.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(t,a){function i(){var e=t.options,i=e["flash policy port"],s=["http"+(e.secure?"s":"")+":/",e.host+":"+e.port,e.resource,"static/flashsocket","WebSocketMain"+(t.isXDomain()?"Insecure":"")+".swf"];n.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=s.join("/")),843!==i&&WebSocket.loadFlashPolicyFile("xmlsocket://"+e.host+":"+i),WebSocket.__initialize(),n.loaded=!0),a.call(o)}var o=this;return document.body?i():void e.util.load(i)},n.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),e.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function t(){if(!P){try{var t=j.getElementsByTagName("body")[0].appendChild(g("span"));t.parentNode.removeChild(t)}catch(e){return}P=!0;for(var n=W.length,a=0;n>a;a++)W[a]()}}function e(t){P?t():W[W.length]=t}function n(t){if(typeof D.addEventListener!=x)D.addEventListener("load",t,!1);else if(typeof j.addEventListener!=x)j.addEventListener("load",t,!1);else if(typeof D.attachEvent!=x)v(D,"onload",t);else if("function"==typeof D.onload){var e=D.onload;D.onload=function(){e(),t()}}else D.onload=t}function a(){L?i():o()}function i(){var t=j.getElementsByTagName("body")[0],e=g(A);e.setAttribute("type",R);var n=t.appendChild(e);if(n){var a=0;!function(){if(typeof n.GetVariable!=x){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),J.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(10>a)return a++,void setTimeout(arguments.callee,10);t.removeChild(e),n=null,o()}()}else o()}function o(){var t=U.length;if(t>0)for(var e=0;t>e;e++){var n=U[e].id,a=U[e].callbackFn,i={success:!1,id:n};if(J.pv[0]>0){var o=f(n);if(o)if(!y(U[e].swfVersion)||J.wk&&J.wk<312)if(U[e].expressInstall&&r()){var h={};h.data=U[e].expressInstall,h.width=o.getAttribute("width")||"0",h.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(h.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(h.align=o.getAttribute("align"));for(var u={},l=o.getElementsByTagName("param"),d=l.length,m=0;d>m;m++)"movie"!=l[m].getAttribute("name").toLowerCase()&&(u[l[m].getAttribute("name")]=l[m].getAttribute("value"));c(h,u,n,a)}else p(o),a&&a(i);else b(n,!0),a&&(i.success=!0,i.ref=s(n),a(i))}else if(b(n,!0),a){var g=s(n);g&&typeof g.SetVariable!=x&&(i.success=!0,i.ref=g),a(i)}}}function s(t){var e=null,n=f(t);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=x)e=n;else{var a=n.getElementsByTagName(A)[0];a&&(e=a)}return e}function r(){return!H&&y("6.0.65")&&(J.win||J.mac)&&!(J.wk&&J.wk<312)}function c(t,e,n,a){H=!0,I=a||null,S={success:!1,id:n};var i=f(n);if(i){"OBJECT"==i.nodeName?(w=h(i),T=null):(w=i,T=n),t.id=O,(typeof t.width==x||!/%$/.test(t.width)&&parseInt(t.width,10)<310)&&(t.width="310"),(typeof t.height==x||!/%$/.test(t.height)&&parseInt(t.height,10)<137)&&(t.height="137"),j.title=j.title.slice(0,47)+" - Flash Player Installation";var o=J.ie&&J.win?["Active"].concat("").join("X"):"PlugIn",s="MMredirectURL="+D.location.toString().replace(/&/g,"%26")+"&MMplayerType="+o+"&MMdoctitle="+j.title;if(typeof e.flashvars!=x?e.flashvars+="&"+s:e.flashvars=s,J.ie&&J.win&&4!=i.readyState){var r=g("div");n+="SWFObjectNew",r.setAttribute("id",n),i.parentNode.insertBefore(r,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}u(t,e,n)}}function p(t){if(J.ie&&J.win&&4!=t.readyState){var e=g("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(h(t),e),t.style.display="none",function(){4==t.readyState?t.parentNode.removeChild(t):setTimeout(arguments.callee,10)}()}else t.parentNode.replaceChild(h(t),t)}function h(t){var e=g("div");if(J.win&&J.ie)e.innerHTML=t.innerHTML;else{var n=t.getElementsByTagName(A)[0];if(n){var a=n.childNodes;if(a)for(var i=a.length,o=0;i>o;o++)(1!=a[o].nodeType||"PARAM"!=a[o].nodeName)&&8!=a[o].nodeType&&e.appendChild(a[o].cloneNode(!0))}}return e}function u(t,e,n){var a,i=f(n);if(J.wk&&J.wk<312)return a;if(i)if(typeof t.id==x&&(t.id=n),J.ie&&J.win){var o="";for(var s in t)t[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?e.movie=t[s]:"styleclass"==s.toLowerCase()?o+=' class="'+t[s]+'"':"classid"!=s.toLowerCase()&&(o+=" "+s+'="'+t[s]+'"'));var r="";for(var c in e)e[c]!=Object.prototype[c]&&(r+='<param name="'+c+'" value="'+e[c]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+o+">"+r+"</object>",F[F.length]=t.id,a=f(t.id)}else{var p=g(A);p.setAttribute("type",R);for(var h in t)t[h]!=Object.prototype[h]&&("styleclass"==h.toLowerCase()?p.setAttribute("class",t[h]):"classid"!=h.toLowerCase()&&p.setAttribute(h,t[h]));for(var u in e)e[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&l(p,u,e[u]);i.parentNode.replaceChild(p,i),a=p}return a}function l(t,e,n){var a=g("param");a.setAttribute("name",e),a.setAttribute("value",n),t.appendChild(a)}function d(t){var e=f(t);e&&"OBJECT"==e.nodeName&&(J.ie&&J.win?(e.style.display="none",function(){4==e.readyState?m(t):setTimeout(arguments.callee,10)}()):e.parentNode.removeChild(e))}function m(t){var e=f(t);if(e){for(var n in e)"function"==typeof e[n]&&(e[n]=null);e.parentNode.removeChild(e)}}function f(t){var e=null;try{e=j.getElementById(t)}catch(n){}return e}function g(t){return j.createElement(t)}function v(t,e,n){t.attachEvent(e,n),q[q.length]=[t,e,n]}function y(t){var e=J.pv,n=t.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,e[0]>n[0]||e[0]==n[0]&&e[1]>n[1]||e[0]==n[0]&&e[1]==n[1]&&e[2]>=n[2]?!0:!1}function C(t,e,n,a){if(!J.ie||!J.mac){var i=j.getElementsByTagName("head")[0];if(i){var o=n&&"string"==typeof n?n:"screen";if(a&&(k=null,M=null),!k||M!=o){var s=g("style");s.setAttribute("type","text/css"),s.setAttribute("media",o),k=i.appendChild(s),J.ie&&J.win&&typeof j.styleSheets!=x&&j.styleSheets.length>0&&(k=j.styleSheets[j.styleSheets.length-1]),M=o}J.ie&&J.win?k&&typeof k.addRule==A&&k.addRule(t,e):k&&typeof j.createTextNode!=x&&k.appendChild(j.createTextNode(t+" {"+e+"}"))}}}function b(t,e){if(V){var n=e?"visible":"hidden";P&&f(t)?f(t).style.visibility=n:C("#"+t,"visibility:"+n)}}function _(t){var e=/[\\\"<>\.;]/,n=null!=e.exec(t);return n&&typeof encodeURIComponent!=x?encodeURIComponent(t):t}{var w,T,I,S,k,M,x="undefined",A="object",E="Shockwave Flash",N="ShockwaveFlash.ShockwaveFlash",R="application/x-shockwave-flash",O="SWFObjectExprInst",$="onreadystatechange",D=window,j=document,B=navigator,L=!1,W=[a],U=[],F=[],q=[],P=!1,H=!1,V=!0,J=function(){var t=typeof j.getElementById!=x&&typeof j.getElementsByTagName!=x&&typeof j.createElement!=x,e=B.userAgent.toLowerCase(),n=B.platform.toLowerCase(),a=/win/.test(n?n:e),i=/mac/.test(n?n:e),o=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,s=!1,r=[0,0,0],c=null;if(typeof B.plugins!=x&&typeof B.plugins[E]==A)c=B.plugins[E].description,c&&(typeof B.mimeTypes==x||!B.mimeTypes[R]||!!B.mimeTypes[R].enabledPlugin)&&(L=!0,s=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),r[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),r[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),r[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof D[["Active"].concat("Object").join("X")]!=x)try{var p=new(window[["Active"].concat("Object").join("X")])(N);p&&(c=p.GetVariable("$version"),c&&(s=!0,c=c.split(" ")[1].split(","),r=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(h){}return{w3:t,pv:r,wk:o,ie:s,win:a,mac:i}}();!function(){J.w3&&((typeof j.readyState!=x&&"complete"==j.readyState||typeof j.readyState==x&&(j.getElementsByTagName("body")[0]||j.body))&&t(),P||(typeof j.addEventListener!=x&&j.addEventListener("DOMContentLoaded",t,!1),J.ie&&J.win&&(j.attachEvent($,function(){"complete"==j.readyState&&(j.detachEvent($,arguments.callee),t())}),D==top&&function(){if(!P){try{j.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}t()}}()),J.wk&&function(){return P?void 0:/loaded|complete/.test(j.readyState)?void t():void setTimeout(arguments.callee,0)}(),n(t)))}(),function(){J.ie&&J.win&&window.attachEvent("onunload",function(){for(var t=q.length,e=0;t>e;e++)q[e][0].detachEvent(q[e][1],q[e][2]);for(var n=F.length,a=0;n>a;a++)d(F[a]);for(var i in J)J[i]=null;J=null;for(var o in swfobject)swfobject[o]=null;swfobject=null})}()}return{registerObject:function(t,e,n,a){if(J.w3&&t&&e){var i={};i.id=t,i.swfVersion=e,i.expressInstall=n,i.callbackFn=a,U[U.length]=i,b(t,!1)}else a&&a({success:!1,id:t})},getObjectById:function(t){return J.w3?s(t):void 0},embedSWF:function(t,n,a,i,o,s,p,h,l,d){var m={success:!1,id:n};J.w3&&!(J.wk&&J.wk<312)&&t&&n&&a&&i&&o?(b(n,!1),e(function(){a+="",i+="";var e={};if(l&&typeof l===A)for(var f in l)e[f]=l[f];e.data=t,e.width=a,e.height=i;var g={};if(h&&typeof h===A)for(var v in h)g[v]=h[v];if(p&&typeof p===A)for(var C in p)typeof g.flashvars!=x?g.flashvars+="&"+C+"="+p[C]:g.flashvars=C+"="+p[C];if(y(o)){var _=u(e,g,n);e.id==n&&b(n,!0),m.success=!0,m.ref=_}else{if(s&&r())return e.data=s,void c(e,g,n,d);b(n,!0)}d&&d(m)})):d&&d(m)},switchOffAutoHideShow:function(){V=!1},ua:J,getFlashPlayerVersion:function(){return{major:J.pv[0],minor:J.pv[1],release:J.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(t,e,n){return J.w3?u(t,e,n):void 0},showExpressInstall:function(t,e,n,a){J.w3&&r()&&c(t,e,n,a)},removeSWF:function(t){J.w3&&d(t)},createCSS:function(t,e,n,a){J.w3&&C(t,e,n,a)},addDomLoadEvent:e,addLoadEvent:n,getQueryParamValue:function(t){var e=j.location.search||j.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return _(e);for(var n=e.split("&"),a=0;a<n.length;a++)if(n[a].substring(0,n[a].indexOf("="))==t)return _(n[a].substring(n[a].indexOf("=")+1))}return""},expressInstallCallback:function(){if(H){var t=f(O);t&&w&&(t.parentNode.replaceChild(w,t),T&&(b(T,!0),J.ie&&J.win&&(w.style.display="block")),I&&I(S)),H=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var t=window.console;return t&&t.log&&t.error||(t={log:function(){},error:function(){}}),swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&t.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(t,e,n,a,i){var o=this;o.__id=WebSocket.__nextId++,WebSocket.__instances[o.__id]=o,o.readyState=WebSocket.CONNECTING,o.bufferedAmount=0,o.__events={},e?"string"==typeof e&&(e=[e]):e=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(o.__id,t,e,n||null,a||0,i||null)})},0)},WebSocket.prototype.send=function(t){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var e=WebSocket.__flash.send(this.__id,encodeURIComponent(t));return 0>e?!0:(this.bufferedAmount+=e,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(t,e){t in this.__events||(this.__events[t]=[]),this.__events[t].push(e)},WebSocket.prototype.removeEventListener=function(t,e){if(t in this.__events)for(var n=this.__events[t],a=n.length-1;a>=0;--a)if(n[a]===e){n.splice(a,1);break}},WebSocket.prototype.dispatchEvent=function(t){for(var e=this.__events[t.type]||[],n=0;n<e.length;++n)e[n](t);var a=this["on"+t.type];a&&a(t)},WebSocket.prototype.__handleEvent=function(t){"readyState"in t&&(this.readyState=t.readyState),"protocol"in t&&(this.protocol=t.protocol);var e;if("open"==t.type||"error"==t.type)e=this.__createSimpleEvent(t.type);else if("close"==t.type)e=this.__createSimpleEvent("close");else{if("message"!=t.type)throw"unknown event type: "+t.type;var n=decodeURIComponent(t.message);e=this.__createMessageEvent("message",n)}this.dispatchEvent(e)},WebSocket.prototype.__createSimpleEvent=function(t){if(document.createEvent&&window.Event){var e=document.createEvent("Event");return e.initEvent(t,!1,!1),e}return{type:t,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(t,e){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,e,null,null,window,null),n}return{type:t,data:e,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(t){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(t)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void t.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");var e=document.createElement("div");e.id="webSocketContainer",e.style.position="absolute",WebSocket.__isFlashLite()?(e.style.left="0px",e.style.top="0px"):(e.style.left="-100px",e.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",e.appendChild(n),document.body.appendChild(e),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(e){e.success||t.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var t=0;t<WebSocket.__tasks.length;++t)WebSocket.__tasks[t]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var e=WebSocket.__flash.receiveEvents(),n=0;n<e.length;++n)WebSocket.__instances[e[n].webSocketId].__handleEvent(e[n])}catch(a){t.error(a)}},0),!0},WebSocket.__log=function(e){t.log(decodeURIComponent(e))},WebSocket.__error=function(e){t.error(decodeURIComponent(e))},WebSocket.__addTask=function(t){WebSocket.__flash?t():WebSocket.__tasks.push(t)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var t=window.navigator.mimeTypes["application/x-shockwave-flash"];return t&&t.enabledPlugin&&t.enabledPlugin.filename&&t.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()})),void 0):void t.error("Flash Player >= 10.0.0 is required.")}}(),function(t,e,n){function a(t){t&&(e.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}t.XHR=a,e.util.inherit(a,e.Transport),a.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},a.prototype.payload=function(t){for(var n=[],a=0,i=t.length;i>a;a++)n.push(e.parser.encodePacket(t[a]));this.send(e.parser.encodePayload(n))},a.prototype.send=function(t){return this.post(t),this},a.prototype.post=function(t){function e(){4==this.readyState&&(this.onreadystatechange=i,o.posting=!1,200==this.status?o.socket.setBuffer(!1):o.onClose())}function a(){this.onload=i,o.socket.setBuffer(!1)}var o=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=a:this.sendXHR.onreadystatechange=e,this.sendXHR.send(t)},a.prototype.close=function(){return this.onClose(),this},a.prototype.request=function(t){var n=e.util.request(this.socket.isXDomain()),a=e.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(t||"GET",this.prepareUrl()+a,!0),"POST"==t)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},a.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},a.check=function(t,a){try{var i=e.util.request(a),o=n.XDomainRequest&&i instanceof XDomainRequest,s=t&&t.options&&t.options.secure?"https:":"http:",r=n.location&&s!=n.location.protocol;if(i&&(!o||!r))return!0}catch(c){}return!1},a.xdomainCheck=function(t){return a.check(t,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function n(){e.Transport.XHR.apply(this,arguments)}t.htmlfile=n,e.util.inherit(n,e.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var t=this.doc.createElement("div");t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe);var n=this,a=e.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+a,e.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(t,e){t=t.replace(/\\\//g,"/"),this.onData(t);try{var n=e.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(a){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),e.Transport.XHR.prototype.close.call(this)},n.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&e.Transport.XHR.check(t)}catch(a){}return!1},n.xdomainCheck=function(){return!1},e.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,n){function a(){e.Transport.XHR.apply(this,arguments)}function i(){}t["xhr-polling"]=a,e.util.inherit(a,e.Transport.XHR),e.util.merge(a,e.Transport.XHR),a.prototype.name="xhr-polling",a.prototype.heartbeats=function(){return!1},a.prototype.open=function(){var t=this;return e.Transport.XHR.prototype.open.call(t),!1},a.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(o.onData(this.responseText),o.get()):o.onClose())}function e(){this.onload=i,this.onerror=i,o.retryCounter=1,o.onData(this.responseText),o.get()}function a(){o.retryCounter++,!o.retryCounter||o.retryCounter>3?o.onClose():o.get()}if(this.isOpen){var o=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=a):this.xhr.onreadystatechange=t,this.xhr.send(null)}},a.prototype.onClose=function(){if(e.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(t){}this.xhr=null}},a.prototype.ready=function(t,n){var a=this;e.util.defer(function(){n.call(a)})},e.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e,n){function a(){e.Transport["xhr-polling"].apply(this,arguments),this.index=e.j.length;var t=this;e.j.push(function(e){t._(e)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;t["jsonp-polling"]=a,e.util.inherit(a,e.Transport["xhr-polling"]),a.prototype.name="jsonp-polling",a.prototype.post=function(t){function n(){a(),i.socket.setBuffer(!1)}function a(){i.iframe&&i.form.removeChild(i.iframe);try{s=document.createElement('<iframe name="'+i.iframeId+'">')}catch(t){s=document.createElement("iframe"),s.name=i.iframeId}s.id=i.iframeId,i.form.appendChild(s),i.iframe=s}var i=this,o=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,r=document.createElement("form"),c=document.createElement("textarea"),p=this.iframeId="socketio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.display="none",r.target=p,r.method="POST",r.setAttribute("accept-charset","utf-8"),c.name="d",r.appendChild(c),document.body.appendChild(r),this.form=r,this.area=c}this.form.action=this.prepareUrl()+o,a(),this.area.value=e.JSON.stringify(t);try{this.form.submit()}catch(h){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},a.prototype.get=function(){var t=this,n=document.createElement("script"),a=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+a,n.onerror=function(){t.onClose()};var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o),this.script=n,i&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},a.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},a.prototype.ready=function(t,n){var a=this;return i?void e.util.load(function(){n.call(a)}):n.call(this)},a.check=function(){return"document"in n},a.xdomainCheck=function(){return!0},e.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})}(),function(){function t(){}var e=function(t){return"[object Array]"==t.toString()},n=this;"undefined"!=typeof module&&module.exports?module.exports.EventEmitter=t:(n=window,n.EventEmitter=t);var a=10;t.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._maxListeners=t},t.prototype.emit=function(){var t=arguments[0];if("error"===t&&(!this._events||!this._events.error||e(this._events.error)&&!this._events.error.length)){if(this.domain){var n=arguments[1];return n.domain_emitter=this,n.domain=this.domain,n.domain_thrown=!1,this.domain.emit("error",n),!1}throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");

}if(!this._events)return!1;var a=this._events[t];if(!a)return!1;if("function"==typeof a){switch(this.domain&&this.domain.enter(),arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:for(var i=arguments.length,o=new Array(i-1),s=1;i>s;s++)o[s-1]=arguments[s];a.apply(this,o)}return this.domain&&this.domain.exit(),!0}if(e(a)){this.domain&&this.domain.enter();for(var i=arguments.length,o=new Array(i-1),s=1;i>s;s++)o[s-1]=arguments[s];for(var r=a.slice(),s=0,i=r.length;i>s;s++)r[s].apply(this,o);return this.domain&&this.domain.exit(),!0}return!1},t.prototype.addListener=function(t,n){if("function"!=typeof n)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,"function"==typeof n.listener?n.listener:n),this._events[t]?e(this._events[t])?this._events[t].push(n):this._events[t]=[this._events[t],n]:this._events[t]=n,e(this._events[t])&&!this._events[t].warned){var i;i=void 0!==this._maxListeners?this._maxListeners:a,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0)}return this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(t,e){function n(){a.removeListener(t,n),e.apply(this,arguments)}if("function"!=typeof e)throw new Error(".once only takes instances of Function");var a=this;return n.listener=e,a.on(t,n),this},t.prototype.removeListener=function(t,n){if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var a=this._events[t];if(e(a)){for(var i=-1,o=0,s=a.length;s>o;o++)if(a[o]===n||a[o].listener&&a[o].listener===n){i=o;break}if(0>i)return this;a.splice(i,1)}else(a===n||a.listener&&a.listener===n)&&delete this._events[t];return this},t.prototype.removeAllListeners=function(t){if(0===arguments.length)return this._events={},this;var n=this._events&&this._events[t];return n?(e(n)?n.splice(0):this._events[t]=null,this):this},t.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),e(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}(),function(){"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e});var t=window,e=Object.create(EventEmitter.prototype);t.pomelo=e;var n=null,a=1,i={};e.init=function(t,a){e.params=t,t.debug=!0;var i=t.host,r=t.port,c="https://"+i;r&&(c+=":"+r),n=io.connect(c,{"force new connection":!0,reconnect:!0}),n.on("connect",function(){a&&a(n)}),n.on("message",function(t){"string"==typeof t&&(t=JSON.parse(t)),t instanceof Array?s(e,t):o(e,t)}),n.on("error",function(t){e.emit("error",t)}),n.on("disconnect",function(t){e.emit("disconnect",t)})},e.disconnect=function(){n&&(n.disconnect(),n=null)},e.request=function(t){if(t){var e,o={};arguments=Array.prototype.slice.apply(arguments),2===arguments.length?"function"==typeof arguments[1]?e=arguments[1]:"object"==typeof arguments[1]&&(o=arguments[1]):3===arguments.length&&(o=arguments[1],e=arguments[2]),a++,i[a]=e;var s={id:a,route:t,msg:o},r=JSON.stringify(s);n.send(r)}},e.notify=function(t,e){this.request(t,e)};var o=function(t,e){function n(e){var n=e.route;if(n)if(e.body){var a=e.body.body;a||(a=e.body),t.emit(n,a)}else t.emit(n,e);else t.emit(e.body.route,e.body)}if(e.id){var a=i[e.id];if(delete i[e.id],"function"!=typeof a)return;return void a(e.body)}n(e)},s=function(t,e){for(var n=0,a=e.length;a>n;n++)o(t,e[n])}}(),window.Messenger=function(){function t(t,e,n){var a="";if(arguments.length<2?a="target error - target and name are both required":"object"!=typeof t?a="target error - target itself must be window object":"string"!=typeof e&&(a="target error - target name must be string type"),a)throw new Error(a);this.target=t,this.name=e,this.prefix=n}function e(t,e){this.targets={},this.name=t,this.listenFunc=[],this.prefix=e||n,this.initListen()}var n="[mantis]",a="postMessage"in window;return t.prototype.send=a?function(t){this.target.postMessage(this.prefix+"|"+this.name+"__Messenger__"+t,"*")}:function(t){var e=window.navigator[this.prefix+this.name];if("function"!=typeof e)throw new Error("target callback function is not defined");e(this.prefix+"|"+this.name+"__Messenger__"+t,window)},e.prototype.addTarget=function(e,n){var a=new t(e,n,this.prefix);this.targets[n]=a},e.prototype.initListen=function(){var t=this,e=function(e){if("object"==typeof e&&(e=e.data),e&&"string"==typeof e)for(var n=e.split("__Messenger__"),e=n[1],a=n[0].split("|"),i=a[0],o=a[1],s=0;s<t.listenFunc.length;s++)i+o===t.prefix+t.name&&t.listenFunc[s](e)};a?"addEventListener"in document?window.addEventListener("message",e,!1):"attachEvent"in document&&window.attachEvent("onmessage",e):window.navigator[this.prefix+this.name]=e},e.prototype.listen=function(t){for(var e=0,n=this.listenFunc.length,a=!1;n>e;e++)if(this.listenFunc[e]==t){a=!0;break}a||this.listenFunc.push(t)},e.prototype.clear=function(){this.listenFunc=[]},e.prototype.send=function(t){var e,n=this.targets;for(e in n)n.hasOwnProperty(e)&&n[e].send(t)},e}();var mantis={},mantisChat={};mantisChat.isShow=!1,mantisChat.unReadMsgCount=0,mantisChat.pomelo=window.pomelo,mantisChat.paras={},mantisChat.chat={},mantisChat.paras.miniChatLoc="right",mantisChat.request={},mantisChat.messager=new Messenger("chatFrame","mantisFrame");var baseMouseX,baseMouseY,agentKeyInInterval=null,isKeyInShow=!1,agentKeyInStep=0,agentKeyInLimit=0,lastVisitorMsgTime=(new Date).getTime(),lastVisitorReminderTime=(new Date).getTime(),lastCounselorMsgTime=(new Date).getTime(),MAX_REMINDER=2,REMINDER_INTERVAL=5,reminderCount=0,preSndTimer;mantisChat.chat.connected=!1,mantisChat.chat.isConnecting=!1;var resendMessages=[],reminderTmr,agentTimedTimer,robotAutoMsgTmr,robotAutoMsgCount=0,mbRemoveTag,trackId,beginTime=(new Date).getTime(),page_url=null,welcomeMsgs=[],welcomeMsgTmr,defaultConfig={tip:{pc:{enable:!0},mobile:{enable:!0}},welcome:{group:!1,media:!1,bu:!1,project:!0,brand:!1},chat:{remInterval:3,maxRemCount:2,multipleSites:!1,mbRemoveTag:!0,miniChatLoc:"center",mode:"MINI",showAgentName:!1,agent_img:"https://probe.bjmantis.net/chat/img/8888/10003/pc/img/default_counselor.jpg",agent_msg_icon:"https://probe.bjmantis.net/chat/img/8888/10003/pc/img/default_counselor.jpg",mini_chat_template:"t1/pc/mini_fm_tab0.html",mini_chat_width:638,mini_chat_height:590,mini_resv_width:350,mini_resv_height:320,mb_chat_template:"t1/mobile/chat.html",mb_chat_template_iframe:"t1/mobile/chat_iframe.html",mbChatHeaderTitleImg:"https://probe.bjmantis.net/chat/img/8888/10003/pc/img/default_counselor.jpg",mbChatHeaderTitleTxt:"咨询对话",w_chat_template:"t1/pc/edu_chat_max.html"}},ADVARRAY=[{clue:"baidu.com",ad:"baidu",type:"sem",searchwd:["wd","word"],suggest:["sug"],bf_searchwd:["oq"],open_searchwd:["bs"]},{clue:"sogou.com",ad:"sogou",type:"sem",searchwd:["query","keyword"]},{clue:"so.com",ad:"360",type:"sem",searchwd:["q"]},{clue:"sm.cn",ad:"shenma",type:"sem",searchwd:["q"]},{clue:"bing.com",ad:"bing",type:"sem",searchwd:["q"],bf_searchwd:["pq"]},{clue:"120ask",ad:"120ask",type:"dsp"},{clue:"demo.bjmantis.net",ad:"baidu",type:"sem",searchwd:["wd","word"],suggest:["sug"],bf_searchwd:["oq"],open_searchwd:["bs"]}],loadProbe=function(t,e,n){$.support.cors=!0,$.ajax({dataType:"json",url:"https://probe.bjmantis.net/"+t+".json",crossDomain:!0,success:e,error:n})},loadProbeCallBack=function(t){return t?(mantisChat.paras.probe=t,void loadConfig()):void console.error("no probe found")},getUrlVars=function(t){var e={},n=t.indexOf("?"),a=t.lastIndexOf("?");if(-1===a||-1===n)return e;var i;i=n===a?t.substr(n,t.length):t.substr(n,a+1);i.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,a){e[n]=a});return e},handleUid=function(t){var e="@"+mantisChat.paras.companyId;if(t&&"undefined"!==t)return Cookies.set("mantis"+mantisChat.paras.companyId,t,{expires:1e3}),t;var n=Cookies.get("mantis"+mantisChat.paras.companyId);if(n&&"undefined"!==n&&n.replace(/(^s*)|(s*$)/g,"").length>0&&n.indexOf(e)>0)return n;var a=createGuid()+"@"+mantisChat.paras.companyId;return Cookies.set("mantis"+mantisChat.paras.companyId,a,{expires:1e3}),a},handleMantisId=function(t){var e=Cookies.get("mantisId");if(e&&"undefined"!==e&&e.replace(/(^s*)|(s*$)/g,"").length>0)return e;if(t&&"undefined"!==t)return Cookies.set("mantisId",t,{expires:1e3}),t;var n=createGuid();return Cookies.set("mantisId",n,{expires:1e3}),n},parseUrl=function(t){var e=t.split("&met=",2),n=getUrlVars(e[0]),a=n.isMock;if(a){mantisChat.paras.probe={},mantisChat.paras.isMock=!0,mantisChat.paras.companyId=parseInt(n.mcid),mantisChat.paras.buId=parseInt(n.mbuid);var i=n.pcTitleLogoUrl;i&&(mantisChat.paras.probe.pcTitleLogoUrl=decodeURIComponent(i));var o=n.pcTitleTxt;o&&(mantisChat.paras.probe.pcTitleTxt=decodeURIComponent(o));var s=n.pcAgentIcon;s&&(mantisChat.paras.probe.pcAgentIcon=decodeURIComponent(s));var r=n.pcPromTxt;r&&(mantisChat.paras.probe.pcPromTxt=decodeURIComponent(r));var c=n.pcTab1PicUrl;c&&(mantisChat.paras.probe.pcTab1PicUrl=decodeURIComponent(c));var p=n.pcSndBtnColor;p&&(mantisChat.paras.probe.pcSndBtnColor=decodeURIComponent(p));var h=n.pcTitleColor;h&&(mantisChat.paras.probe.pcTitleColor=decodeURIComponent(h));var u=n.pcBorderColor;u&&(mantisChat.paras.probe.pcBorderColor=decodeURIComponent(u));var l=n.pcTitleTxtColor;return void(l&&(mantisChat.paras.probe.pcTitleTxtColor=decodeURIComponent(l)))}n.mpath&&(mantisChat.paras.uiPath=decodeURIComponent(n.mpath)),n.mxst&&(mantisChat.paras.xst=n.mxst),mantisChat.paras.companyId=parseInt(n.mcid),mantisChat.paras.buId=parseInt(n.mbuid),mantisChat.paras.uid=handleUid(n.muid),mantisChat.paras.mantisId=handleMantisId(n.muuid),mantisChat.paras.siteId="undefined"===n.msid?null:parseInt(n.msid),mantisChat.paras.siteId||"undefined"===n.sid||(mantisChat.paras.siteId=parseInt(n.sid)),mantisChat.paras.ipCheck="undefined"===n.mcc?0:parseInt(n.mcc),"undefined"===mantisChat.paras.siteId&&(mantisChat.paras.siteId=null),mantisChat.paras.stag=n.mstag,"undefined"===mantisChat.paras.stag&&(mantisChat.paras.stag=null),""===mantisChat.paras.stag&&(mantisChat.paras.stag=null),mantisChat.paras.mhash=n.mh?decodeURIComponent(n.mh):"",mantisChat.paras.ctag=n.mctag?decodeURIComponent(n.mctag):"",mantisChat.paras.loc=n.mloc,e.length>1&&(mantisChat.paras.et=e[1],mantisChat.paras.lp=encodeURI(mantisChat.paras.et&&"undefined"!==mantisChat.paras.et?mySubStr(mantisChat.paras.et,3e3):mySubStr(window.location.href,3e3))),page_url=document.referrer,!page_url||page_url.indexOf("bjmantis.net")>0?page_url=mantisChat.paras.lp:mantisChat.paras.chatPageUrl=mySubStr(page_url+mantisChat.paras.mhash,3e3);var d=n.mgid;(!d||isNaN(d))&&(d=null),mantisChat.paras.serviceGroupId=d,mantisChat.paras.assignedAgent=n.magent,mantisChat.paras.defaultServiceGroupId=n.mdgid?n.mdgid:null;try{mantisChat.paras.page_title=decodeURIComponent(n.mtitle),mantisChat.paras.ele=n.mele}catch(m){}mantisChat.paras.mode=n.mmode;try{mantisChat.paras.cookieRefer=decodeURIComponent(n.mwd)}catch(m){}mantisChat.paras.flag=n.mflag,mantisChat.paras.projectId=n.mprj?parseInt(n.mprj):null,mantisChat.paras.trackId=n.mtid,mantisChat.paras.lpId=n.mlpid,mantisChat.paras.brand=n.mbrd,mantisChat.paras.pageparam=n.mpageparam,mantisChat.paras.thirdUid=n.mtuid;var f=n.mtac;f&&(mantisChat.paras.thirdAccount=decodeURIComponent(f));var g=n.maff;if(g){mantisChat.paras.aifanfan="Y";var v=n.mbtr;v&&(mantisChat.paras.mbtr=decodeURIComponent(decodeURIComponent(v)))}},sendSystemMsg=function(t){var e="chat.chatHandler.agentSend";mantisChat.chat.connected&&pomelo.request(e,{content:t,chatId:mantisChat.chat.chatId,uid:mantisChat.chat.agent.agentId,channelId:mantisChat.chat.channelId,visitorId:mantisChat.paras.uid,msgType:"A",target:"",type:"text"},function(){})},sendMessage=function(t,e){clearTimeout(preSndTimer);var n,a="chat.chatHandler.customerSend";if(t)n=t;else{var i=$("#chatwindow").val()||$("#chatwindow").html();n=i.replace(/&nbsp;/g," ").replace(/^\s+$/,""),$("#chatwindow").val("").html(""),$("#emojiBox").css({display:"none"})}isBlank(n)||(n=n.replace(/"/g,"'"),lastVisitorMsgTime=(new Date).getTime(),reminderCount=0,mantisChat.chat.connected?pomelo.request(a,{content:n,sgId:mantisChat.chat.sgId,chatId:mantisChat.chat.chatId,agentId:mantisChat.chat.agent.agentId,target:"",type:e||"text",projectId:mantisChat.paras.projectId},function(){addMessage(mantisChat.paras.uid,dateFormat(new Date,"yyyy-MM-dd hh:mm:ss"),n,!1),mantisChat.chat.vistorSent=!0,$("#pcChatNewMsg").css("display","none"),setTimeout(function(){showAgentKeyIn()},600)}):(resendMessages.push(n),addMessage(mantisChat.paras.uid,dateFormat(new Date,"yyyy-MM-dd hh:mm:ss"),n,!1),setTimeout(function(){requestChat()},1e3)))},clearHisMsg=function(){$(".removeClass").remove()},isChatBtnShow=function(){return"block"===$("#MANTIS_CHAT_BTN_DIV").css("display")?!0:!1},remindNewMsg=function(t){if(isChatBtnShow()){var e=t.indexOf("$$MANTIS_MSG_INVITE$$");e>0&&(t=t.substr(0,e)),updateChatBtnTip(t),showNewMsgIcon(!0)}},clearReminder=function(){"none"===$("#MANTIS_CHAT_BTN_DIV").css("display")&&showNewMsgIcon(!1)},showNewMsgIcon=function(t){t?$("#MANTIS-BTN").removeClass("MANTIS-BTN-NORMAL-BACKGROUND").addClass("MANTIS-BTN-BACKGROUND"):$("#MANTIS-BTN").removeClass("MANTIS-BTN-BACKGROUND").addClass("MANTIS-BTN-NORMAL-BACKGROUND")},enableInput=function(){$("#chatwindow").attr("disabled",!1),$("#chatwindow").attr("contenteditable",!0),$("#chatwindow").focus()},disableInput=function(){$("#chatwindow").attr("disabled",!0),$("#chatwindow").attr("contenteditable",!1)},getRequest=function(){var t=mantisChat.request;return t.site_id=mantisChat.paras.siteId,t.stag=mantisChat.paras.stag,t.page_title=mantisChat.paras.page_title,t.req_mode=mantisChat.paras.mode,t.req_ele=mantisChat.paras.ele||"",t.lp=mantisChat.paras.lp,t.url=encodeURI(mantisChat.paras.chatPageUrl),t.lp_id=mantisChat.paras.lpId,t.vistor_id=mantisChat.paras.uid,t.srv_gp_id=mantisChat.paras.serviceGroupId,t.vistor_media=isMobile.any?"mobile":"pc",t.company=mantisChat.paras.companyId,t.buId=mantisChat.paras.buId,t.trackId=mantisChat.paras.trackId||trackId,t.assignedAgent=mantisChat.paras.assignedAgent,t.browser=mantisChat.paras.browser,t.cookieRefer=mantisChat.paras.cookieRefer,t.ipCheck=mantisChat.paras.ipCheck,t.brand=mantisChat.paras.brand,t.chat_page_url=window.location.href,t.ctag=mantisChat.paras.ctag,t.mantisId=mantisChat.paras.mantisId,t.probeId=mantisChat.paras.uiPath,t.aifanfan=mantisChat.paras.aifanfan,t},queryEntry=function(t,e,n){var a="gateSio.gateSioHandler.queryCustomerEntry";pomelo.init({host:mantis_init.chat.host,port:mantis_init.chat.port,log:!0},function(){pomelo.request(a,{uid:t,siteId:e},function(t){return pomelo.disconnect(),500===t.code?void showResvDiv(!0,"fail_to_find_connector"):void n(t.host,t.port)})})},registerListener=function(){pomelo.removeAllListeners(),pomelo.on("onChat",function(t){var e=t.say_from;"V"===e&&(mantisChat.chat.ball={who:"A",lastTime:(new Date).getTime()},"Y"===mantisChat.chat.isRobot&&clearRobotAutoMsgTmr());var n=t.complete||"N";if("Y"===n&&(mantisChat.chat.isComplete="Y"),"A"===e&&(mantisChat.chat.ball={who:"V",lastTime:(new Date).getTime()},"Y"===mantisChat.chat.isRobot&&setRobotAutoMsgTimer()),"V"===e||"A"===e){var a=t.msgType;if(a&&"A"!==a&&clearWelcomeMsgTmr(),t.from===mantisChat.paras.uid)mantisChat.chat.vistorSent=!0,lastVisitorMsgTime=(new Date).getTime(),lastVisitorReminderTime=(new Date).getTime(),reminderCount=0;else{if(a&&"A"!==a&&(mantisChat.chat.agentSent=!0),lastCounselorMsgTime=(new Date).getTime(),mantisChat.chat.connected){var i=t.msg,o=dateFormat(new Date(t.time),"yyyy-MM-dd hh:mm:ss");addMessage(t.from,o,i,!0),onMessageArrive(i)}else requestChat();setTimeout(function(){$("#pcChatNewMsg").css("display","block"),stopAgentKeyIn()},100)}}}),pomelo.on("disconnect",function(){}),pomelo.on("ON_ERROR",function(){mantisChat.chat.connected=!1,mantisChat.chat.isConnecting=!1,pomelo.disconnect(),showResvDiv(!0,"on_error"),clearInterval(reminderTmr),clearInterval(agentTimedTimer),clearRobotAutoMsgTmr()}),pomelo.on("ON_AGENT_LEAVE",function(){console.info("Agent offline, try to request in 30 seconds.."),setTimeout(function(){location.reload()},3e4)}),pomelo.on("ON_HIS_MSG",function(t){clearHisMsg();var e=t.msg;if(e&&0!==e.length){for(var n=e.reverse(),a=0;a<n.length;a++){var i=n[a],o=i.say_from;("V"===o||"A"===o)&&addMessage(i.say_id,i.timeStr,i.msg?i.msg:"",!0)}resendMsg()}}),pomelo.on("ON_NO_AGENT_MATCH",function(){mantisChat.chat.connected=!1,mantisChat.chat.isConnecting=!1,console.warn("NO_AGENT_AVAILABLE"),showResvDiv(!0,"no_agent"),clearInterval(reminderTmr),clearInterval(agentTimedTimer),pomelo.disconnect()}),pomelo.on("ON_WEL_MSG",function(t){clearHisMsg(),welcomeMsgs=[];var e=t.msg,n=!1;if(e)for(var a=0;a<e.length;a++){var i=e[a];if(i)for(var o=0;o<i.length;o++){var s=i[o];if(s.msg)if(n)welcomeMsgs.push(s.msg);else{var r=dateFormat(new Date,"yyyy-MM-dd hh:mm:ss");addMessage("SYSTEM",r,s.msg,!1),n=!0}}}welcomeMsgs.length>0&&(welcomeMsgs.reverse(),startWelcomeMsgTmr()),resendMsg()}),pomelo.on("onKick",function(t){connected=!1,isConnecting=!1,pomelo.disconnect(),console.info("onKick"+JSON.stringify(t))}),pomelo.on("ON_CHANNEL_OK",function(t){mantisChat.chat.connected=!0,mantisChat.chat.isConnecting=!1,mantisChat.chat.agent=t.msg.agent,mantisChat.chat.chatId=t.msg.chatId,mantisChat.chat.channelId=t.msg.channelId,mantisChat.chat.sgId=t.msg.sgId,mantisChat.chat.isRobot=t.msg.isRobot;var e=(new Date).getTime();console.info("setup_time:"+(e-beginTime)+","+mantisChat.chat.chatId),showChatMiniDiv(),enableInput(),reminderCount=0;var n={type:"chat",hasChat:!0,isTimedOut:!1,chatId:mantisChat.chat.chatId};mantisChat.messager.send(JSON.stringify(n));try{var a=t.msg.agent.img;a&&(mantisChat.chat.agent_msg_icon=a)}catch(i){}setTimeout(function(){var e=$("#chat_setup_msg");if(e){var n=t.msg.agent.display_name||"客服",a="对话已经建立完成，<span id='mini_agent_name'>"+n+"</span>正在与您对话";e.html(a)}$("#pcChatNewMsg").css("display","block"),stopAgentKeyIn()},10),mantisChat.paras.mbtr&&sendAiMsg(mantisChat.paras.mbtr),setupRemindTimer(),setAgentTimedTimer()}),pomelo.on("ON_TRANSFER",function(t){console.info("chat transfer event:"+JSON.stringify(t));var e=t.newServiceGroupId,n=t.agentId;return e||n?(e&&(Cookies.set("mantis_sgid"+mantisChat.paras.companyId,e,{expires:1e3}),mantisChat.paras.serviceGroupId=e),n&&(mantisChat.paras.assignedAgent=n),mantisChat.paras.mode="TRANSFER",mantisChat.chat.isConnecting=!1,mantisChat.chat.connected=!1,clearInterval(reminderTmr),clearInterval(agentTimedTimer),pomelo.disconnect(),void requestChat()):void console.error("new ServiceGroupId or newAgentId is undefined")})},setAgentTimedTimer=function(){lastCounselorMsgTime=(new Date).getTime();var t=0;agentTimedTimer&&(clearInterval(agentTimedTimer),agentTimedTimer=null),agentTimedTimer=setInterval(function(){if(mantisChat.chat.chatId&&"Y"!==mantisChat.chat.isComplete){var e=(new Date).getTime(),n=e-lastCounselorMsgTime;if(mantisChat.chat.autoresponder2&&mantisChat.chat.autoresponder2.length&&n>=1e3*mantisChat.chat.counselorExpireTime&&t<mantisChat.chat.counselorAutoResponseCount){t++;var a=Math.round(Math.random()*(mantisChat.chat.autoresponder2.length-1));sendSystemMsg(mantisChat.chat.autoresponder2[a]),onMessageArrive(mantisChat.chat.autoresponder2[a]),lastCounselorMsgTime=(new Date).getTime()}}},5e3)},setRobotAutoMsgTimer=function(){robotAutoMsgTmr&&(clearInterval(robotAutoMsgTmr),robotAutoMsgTmr=null),robotAutoMsgTmr=setInterval(function(){if("Y"!==mantisChat.chat.isComplete&&mantisChat.chat.ball&&mantisChat.chat.ball.who&&mantisChat.chat.vistorSent&&!(robotAutoMsgCount>2)&&"A"!==mantisChat.chat.ball.who){var t=mantisChat.chat.ball.lastTime;if(t&&0!==t){var e=(new Date).getTime()-t;e>15e3+Math.floor(5e3*Math.random()+1)&&(robotAutoMsgCount+=1,sendAutoReq())}}},5e3)},clearRobotAutoMsgTmr=function(){robotAutoMsgCount=0,robotAutoMsgTmr&&(clearInterval(robotAutoMsgTmr),robotAutoMsgTmr=null)},startWelcomeMsgTmr=function(){welcomeMsgTmr=setInterval(function(){welcomeMsgs&&0!==welcomeMsgs.length&&(mantisChat.chat.vistorSent||mantisChat.chat.agentSent||sendSystemMsg(welcomeMsgs.pop()))},3e3)},clearWelcomeMsgTmr=function(){welcomeMsgTmr&&(clearInterval(welcomeMsgTmr),welcomeMsgTmr=null)},setupRemindTimer=function(){lastVisitorMsgTime=(new Date).getTime(),lastVisitorReminderTime=(new Date).getTime();var t=0;reminderTmr&&clearInterval(reminderTmr),reminderTmr=setInterval(function(){if(mantisChat.chat.chatId&&"Y"!==mantisChat.chat.isComplete){var e=(new Date).getTime()-lastVisitorReminderTime;if(mantisChat.chat.autoresponder1&&mantisChat.chat.autoresponder1.length&&e>=1e3*mantisChat.chat.visitantExpireTime&&t<mantisChat.chat.visitantAutoResponseCount){t++;var n=Math.round(Math.random()*(mantisChat.chat.autoresponder1.length-1));sendSystemMsg(mantisChat.chat.autoresponder1[n]),onMessageArrive(mantisChat.chat.autoresponder1[n]),lastVisitorReminderTime=(new Date).getTime()}var a=(new Date).getTime()-lastVisitorMsgTime;if(a>REMINDER_INTERVAL*MAX_REMINDER*60*1e3&&mantisChat.chat.connected){pomelo.disconnect(),mantisChat.chat.connected=!1,mantisChat.chat.chatId=null,reminderCount=0,stopAgentKeyIn(),clearInterval(reminderTmr),clearInterval(agentTimedTimer);var i={type:"chat",hasChat:!1,isTimedOut:!0,chatId:null};mantisChat.messager.send(JSON.stringify(i))}}},5e3)},handleLeaveMsg=function(t){sendEntry(t)},requestChat=function(){return mantisChat.chat.isConnecting?(showChatMiniDiv(),void scrollDown()):mantisChat.chat.connected?(showChatMiniDiv(),void scrollDown()):void queryEntry(mantisChat.paras.uid,mantisChat.paras.siteId,requestChatInner)},addMessage=function(t,e,n){var a=mantisChat.chat.agent_msg_icon||"./img/default_counselor.jpg";$("#chat_history").append(t===mantisChat.paras.uid?joinRightStr("./img/default_visitor.jpg","",e,n):joinLeftStr(a,"",e,n)),scrollDown()},scrollDown=function(){setTimeout(function(){$("#pcChatContent").scrollTop(99999)},100)},joinLeftStr=function(t,e,n,a){var i=[];return i.push("<div class='msg-box removeClass'>"),i.push("  <div class='msg-agent'>"),i.push("    <div class='agent-avatar'>"),i.push("      <img src='"+t+"'>"),i.push("    </div>"),i.push("    <div class='arrow_box_left'' style='margin-left:10px;'>"),i.push("      <div class='text1'>"+n+"</div>"),i.push("      <div class='text'>"+a+"</div>"),i.push("    </div>"),i.push("  </div>"),i.push("</div>"),i.join("")},joinRightStr=function(t,e,n,a){var i=[];return i.push("<div class='msg-box removeClass'>"),i.push("  <div class='msg-client'>"),i.push("    <div class='client-avatar'>"),i.push("      <img src='"+t+"'>"),i.push("    </div>"),i.push("    <div class='arrow_box' style='margin-right:15px'>"),i.push("      <div class='text1'>"+n+"</div>"),i.push("      <div class='text'>"+a+"</div>"),i.push("    </div>"),i.push("  </div>"),i.push("</div>"),i.join("")},showResvDiv=function(t,e){var n={type:"MANTIS_RESV_WINDOW_FLAG"};if(t){initResv(),n.flag="SHOW";var a=mantisChat.chat.mini_resv_func_show;a?n.func=a:$("#MANTIS_RESV_INNER_DIV").show(),$("#MANTIS_CHAT_INNER_DIV").hide(),$("#MANTIS-BUBBLE").hide(),showNewMsgIcon(!1),$("#MANTIS_CHAT_BTN_DIV").hide(),handleLeaveMsg(e)}else{n.flag="HIDE";var i=mantisChat.chat.mini_resv_func_hide;i?n.func=i:$("#MANTIS_RESV_INNER_DIV").hide(),$("#MANTIS_CHAT_BTN_DIV").show()}mantisChat.messager.send(JSON.stringify(n))},sendAutoReq=function(){mantisChat.isShow=!1;var t="chat.chatHandler.sendAutoReq";mantisChat.chat.connected&&pomelo.request(t,{content:"1111",chatId:mantisChat.chat.chatId,target:""},function(){})},sendAiMsg=function(t){var e="chat.chatHandler.sendAIMsg";mantisChat.chat.connected&&pomelo.request(e,{content:t,chatId:mantisChat.chat.chatId,target:""},function(){})},hideChatMiniDiv=function(){mantisChat.isShow=!1,$("#MANTIS_CHAT_BTN_DIV").show(),$("#MANTIS_CHAT_INNER_DIV").hide(),showResvDiv(!1,"");var t={type:"MANTIS_CHAT_WINDOW_FLAG",flag:"HIDE"};mantisChat.messager.send(JSON.stringify(t));var e="chat.chatHandler.hideIframe";mantisChat.chat.connected&&pomelo.request(e,{content:"聊窗收起",chatId:mantisChat.chat.chatId,target:""},function(){})},showChatMiniDiv=function(){if(mantisChat.unReadMsgCount=0,!mantisChat.isShow){mantisChat.isShow=!0,$("#MANTIS-BTN-ICON-NORMAL").css("display","block"),$("#newMsg").css("display","none"),$("#MANTIS_CHAT_INNER_DIV").show(),showResvDiv(!1,""),$("#MANTIS_CHAT_BTN_DIV").hide(),hideInviteDiv();var t={type:"MANTIS_CHAT_WINDOW_FLAG",flag:"SHOW"};mantisChat.messager.send(JSON.stringify(t))}},hideInviteDiv=function(){var t={type:"MANTIS_HIDE_INVITE"};mantisChat.messager.send(JSON.stringify(t))},updateChatBtnTip=function(t){var e=t;try{e=e.replace(/<\/?[^>]*>/g,"").replace(/&nbsp;/gi,"")}catch(n){}mantisChat.chat.latestMsg!==e&&(mantisChat.chat.latestMsg=e,$("#MANTIS_CHAT_MSG_DIV").html(t),$("#MANTIS-BUBBLE").show("fast"))},mergeProbeSetting=function(){var t=mantisChat.paras.probe;if(t){mantisChat.chat.pcSndBtnColor=t.pcSndBtnColor,mantisChat.chat.pcTitleColor=t.pcTitleColor,mantisChat.chat.pcBorderColor=t.pcBorderColor;var e=t.pcTitleLogoUrl;e&&(mantisChat.chat.logoUrl=e);var n=t.pcTitleTxt;n&&(mantisChat.chat.pcTitleTxt=n,mantisChat.chat.btnMsg=n);var a=t.pcAgentIcon;a&&(mantisChat.chat.agent_msg_icon=a),mantisChat.chat.visitantExpireTime=t.visitantExpireTime||864e3,mantisChat.chat.autoresponder1=t.autoresponder1,mantisChat.chat.visitantAutoResponseCount=t.visitantAutoResponseCount||1,mantisChat.chat.counselorExpireTime=t.counselorExpireTime||864e3,mantisChat.chat.autoresponder2=t.autoresponder2,mantisChat.chat.counselorAutoResponseCount=t.counselorAutoResponseCount||1;var i=t.pcPromTxt;i&&(i=i.replace(/^<p>\s*<\/p>\n*$/,"")),i&&(mantisChat.chat.pcPromTxt=i);var o=t.pcTab1Title;o&&(mantisChat.chat.mini_right_tab1=o);var s=t.pcTab1PicUrl;s&&(mantisChat.chat.mini_right_tab1_content="<img src='"+s+"' />");var r=(t.pcTab1PicHref,t.pcTab2Title);r&&(mantisChat.chat.mini_right_tab2=r);var c=t.pcTab2PicUrl;c&&(mantisChat.chat.mini_right_tab2_content=c);{t.pcTab2PicHref}mantisChat.chat.pcBoxBgColor=t.pcBoxBgColor,mantisChat.chat.pcBoxFontColor=t.pcBoxFontColor,mantisChat.chat.pcBoxContent=t.pcBoxContent;var p=t.pcMsgNotifyMethod;p&&(mantisChat.chat.pcMsgNotifyMethod=p);var h=t.pcMsgAction;h&&(mantisChat.chat.pcMsgAction=h)}},setColor=function(){var t=mantisChat.paras.probe;if(t.pcTitleTxtColor&&$("#pcChatHeaderTitleCentext").css("color",t.pcTitleTxtColor),mantisChat.chat.pcTitleColor&&$("#pcChatHeaderTitle,#TL_trTitle,#ly_btn").css({background:mantisChat.chat.pcTitleColor}),mantisChat.chat.pcBoxBgColor&&($("#MANTIS-BTN").css({background:mantisChat.chat.pcBoxBgColor,color:mantisChat.chat.pcBoxFontColor}),$("#MANTIS-BTN-TEXT").html(mantisChat.chat.pcBoxContent)),mantisChat.chat.pcBorderColor){var e=mantisChat.chat.pcBorderColor;$("#messageRight").css("border-color","transparent "+e+" "+e+" "+e),$("#pcChatMsgDiv").css("border-color",e+" transparent "+e+" "+e),$("#pcChatFooter,#pcChatContent").css("border-left-color",e),$("#pcChatFooter").css("border-bottom-color",e)}mantisChat.chat.pcSndBtnColor&&$("#pcChatSendButton,#ly_btn").css("background",mantisChat.chat.pcSndBtnColor)},setUI=function(t){$("#MANTIS_RESV_OK_MSG").val(t.resv_ok_msg),$("#MANTIS_RESV_ERR_MSG").val(t.resv_error_msg),$("#MANTIS_CHAT_WEL_MSG").val(t.chat_alloc_msg);var e=$("#right_tab1"),n=$("#right_tab2"),a=$("#tab1_content"),i=$("#tab2_content"),o=$("#MANTIS-BTN-TEXT"),s=$("#pcChatHeaderTitlePhoneImg"),r=$("#pcChatHeaderTitleCentext"),c=$("#pcChatWelcom");t.isHiddenCopyright&&$("#pcChatCopyright").css("display","none"),t.hideImgUploadBtn&&($("#fileImg,#img_btn").remove(),$("#pcChatEditor").css({width:"70%"})),t.btnMsg&&o.html(t.btnMsg),t.mini_right_tab1_content&&a&&a.html(t.mini_right_tab1_content),t.mini_right_tab2_content&&i&&i.html(t.mini_right_tab2_content),t.mini_right_tab1&&e&&e.html(t.mini_right_tab1),t.mini_right_tab2&&n&&n.html(t.mini_right_tab2),t.logoUrl&&s.attr("src",t.logoUrl),t.pcTitleTxt&&r.html(t.pcTitleTxt),c&&(t.pcPromTxt?(c.html(t.pcPromTxt),c.show()):c.hide()),changePromDiv(),setColor()},sendClick=function(t){mantisChat.paras.trackId&&$.ajax({type:"POST",url:mantisChat.paras.trackUrl,crossDomain:!0,data:t,dataType:"json",success:function(){},error:function(){console.error("Post click information error-sendClick")}})},clickChatBtn=function(){mantisChat.paras.req_mode="VISTOR",requestChat();var t={};return t.ele_name="右下角客服栏",t.e_id=mantisChat.paras.trackId,t.type="C",sendClick(t),!1},appendCustomizeJS=function(){var t=document.getElementsByTagName("body")[0],e=document.createElement("script");e.type="text/javascript",e.src=getCustomizeJSPath()+"/js/chat.js",t.appendChild(e)},initChat=function(){if(mantisChat.paras.isMock)return $("#MANTIS_CHAT_INNER_DIV").show(),showResvDiv(!1,""),void $("#MANTIS_CHAT_BTN_DIV").hide();if(!mantis_init)return void console.error("Please init the mantis first");var t,e,n=mantis_init.chat.host,a=mantis_init.chat.port;if(mantis_init.t&&mantis_init.t.host?(t=mantis_init.t.host,e=mantis_init.t.port):(t=mantis_init.chat.host,e=80),mantisChat.paras.trackUrl="https://"+t+"/u/1.gif",!(n&&a&&t&&e))return void console.info("please check host and port");mantisChat.con={host:n,port:a};var i=detectUA();if(mantisChat.paras.browser=i?{ua:i.ua,name:i.browser,type:i.device}:{ua:window.navigator.userAgent||""},"2"===mantisChat.chat.flag)return void showResvDiv(!0,"invalid_para");mantisChat.welcome_header=$("#pcChatHeaderTitleCentext").html();var o=Cookies.get("mantis_sgid"+mantisChat.paras.companyId);o&&(mantisChat.paras.serviceGroupId=o),$("#chatwindow").bind("input",function(t){preSndTimer&&clearTimeout(preSndTimer);var e=this.value||t.currentTarget.innerHTML;mantisChat.chat.connected&&e&&(e=e.replace(/"/g,"'"),preSndTimer=setTimeout(function(){if(e){var t={content:e,from:mantisChat.paras.uid,chatId:mantisChat.chat.chatId,agentId:mantisChat.chat.agent.agentId,target:""};pomelo.notify("chat.chatHandler.customerInputing",t)}},500))}),$("#MANTIS-BTN").bind("click",clickChatBtn),$("#chatwindow").on("keydown",function(t){13==t.which&&(t.preventDefault(),sendMessage())}),disableInput(),mantis.hideChatMiniDiv=hideChatMiniDiv,mantis.sendMessage=sendMessage,mantisChat.messager.addTarget(window.parent,"parent"),mantisChat.messager.listen(function(t){var e=JSON.parse(t);if(e&&e.type&&"request"===e.type)switch(e.msg){case"MANTIS_REQUEST":e.beginStr&&mantisChat.paras.aifanfan&&"Y"===mantisChat.paras.aifanfan&&(mantisChat.paras.mbtr=decodeURIComponent(decodeURIComponent(e.beginStr)),changePromDiv()),requestChat()}}),registerListener(),showChatMiniDiv(),requestChat(),appendCustomizeJS()};$(document).ready(function(){window.console=window.console||function(){var t={};return t.log=t.warn=t.debug=t.info=t.error=t.time=t.dir=t.profile=t.clear=t.exception=t.trace=t.assert=function(){},t}(),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,a;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),a=0;o>a;){var s;a in i&&(s=i[a],t.call(n,s,a,i)),a++}}),parseUrl(window.location.href),mantisChat.paras.chatPageUrl||(mantisChat.paras.chatPageUrl=mantisChat.paras.lp),mantisChat.paras.uiPath?loadProbe(mantisChat.paras.uiPath,loadProbeCallBack,function(){console.error("fail to load p, try to load & use default config"),loadConfig()}):loadConfig();var t;t=mantis_init.t&&mantis_init.t.host?mantis_init.t.host:mantis_init.chat.host;var e="https://"+t+"/"+mantisChat.paras.companyId+"/api-war/upload/uploadImg.do?vistorId="+mantisChat.paras.uid+"&companyId="+mantisChat.paras.companyId;$("#emojiBox>img").click(function(){document.getElementById("chatwindow").focus(),document.execCommand("InsertImage",!1,this.src),$("#chatwindow>img").addClass("emojiImg")}),$("#emoji_btn").click(function(){$("#emojiBox").css({display:"none"===$("#emojiBox").css("display")?"block":"none"})});var n=$("#fileImg");n.fileupload({url:e,dataType:"json",
add:function(t,e){var n=e.files[0],a=n.size/1024/1024,i=n.type;if(i){if(!/(png)|(gif)|(jpe?g)|(bmp)$/i.test(i))return void alert("请选择格式为(png/jpg/gif/bmp/jpeg)的图片文件");if(a>5)return void alert("请选择大小在5M以内的文件")}e.submit()},done:function(t,e){var a=e.result.data;if(!a)return void alert(e.result.message);var i="<img src='"+a+"'>";n.val(""),sendMessage(i,"IMG")}})});var paras={};paras.adInfo={};var initResv=function(){if(!mantis_init)return void console.error("Please init the mantis first");var t,e;if(mantis_init.t&&mantis_init.t.host?(t=mantis_init.t.host,e=mantis_init.t.port):(t=mantis_init.chat.host,e=80),!t||!e)return void console.info("please check resv host and port");paras.uid=mantisChat.paras.uid,paras.siteId=mantisChat.paras.siteId||0,paras.stag=mantisChat.paras.stag,paras.companyId=mantisChat.paras.companyId,paras.pageUrl=mantisChat.paras.chatPageUrl,paras.buId=mantisChat.paras.buId,paras.projectId=mantisChat.paras.projectId,paras.referer=mantisChat.paras.referer,paras.lpUrl=mantisChat.paras.lp,paras.cookieRefer=mantisChat.paras.cookieRefer,isMobile&&(paras.reqVistorMedia=isMobile.any?"mobile":"pc"),paras.thirdAccount=mantisChat.paras.thirdAccount,paras.thirdUserId=mantisChat.paras.thirdUid,paras.resv_addr="https://"+t+"/"+paras.companyId+"/api-war/message/insertMessageInfo2.do",paras.entry_addr="https://"+t+"/"+paras.companyId+"/api-war/message/addEntryInfo.do";for(var n="",a=new Date,i="yyyy-MM-dd",o="yyyy年MM月dd日 EEE",s=0;30>s;s++){var r=addDate(a,s),c=getDateFormatString(r,i),p=getDateFormatString(r,o);n+="<option value='"+c+"'>"+p+"</option>"}$("#visit_date").html(n)};